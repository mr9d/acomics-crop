(()=>{"use strict";var e=function(e,t){return n=void 0,o=[e,t],r=function(e,t){var n,o,i=t.quality,r=void 0===i?1:i,c=t.type,a=void 0===c?e.type:c;return function(e,t){var n,o,i,r,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(c=0)),c;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,o=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){c.label=a[1];break}if(6===a[0]&&c.label<i[1]){c.label=i[1],i=a;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(a);break}i[2]&&c.ops.pop(),c.trys.pop();continue}a=t.call(e,c)}catch(e){a=[6,e],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,(function(t){switch(t.label){case 0:return[4,createImageBitmap(e)];case 1:return n=t.sent(),(o=document.createElement("canvas")).width=n.width,o.height=n.height,o.getContext("2d").drawImage(n,0,0),[4,new Promise((function(e){return o.toBlob(e,a,r)}))];case 2:return[2,t.sent()]}}))},new((i=void 0)||(i=Promise))((function(e,t){function c(e){try{u(r.next(e))}catch(e){t(e)}}function a(e){try{u(r.throw(e))}catch(e){t(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(c,a)}u((r=r.apply(n,o||[])).next())}));var n,o,i,r},t=document.createElement("div");t.className="resize-module resize-module_disable",t.insertAdjacentHTML("beforeend",'<div class="resize-module-background"></div> <div class="resize-module-container"> <div class="resize-module-container__header"> <div class="resize-module-container__header-text">Ваша фотография</div> <div class="resize-module-container__close-button"></div> </div> <p class="resize-module-container__body-paragraph"></p> <div class="resize-module-container__body"> <div class="resize-module-container__body-box"> <div class="resize-module-container__body-image"> <div class="resize-module-container__background-box"> <div class="resize-module-container__background resize-module-container__background_pos_t"></div> <div class="resize-module-container__background resize-module-container__background_pos_l"></div> <div class="resize-module-container__background resize-module-container__background_pos_b"></div> <div class="resize-module-container__background resize-module-container__background_pos_r"></div> </div> <div class="resize-module-container__body-image-area"> <div class="scale-cube scale-cube_pos_tl"></div> <div class="scale-cube scale-cube_pos_tr"></div> <div class="scale-cube scale-cube_pos_bl"></div> <div class="scale-cube scale-cube_pos_br"></div> </div> </div> </div> </div> <div class="resize-module-container__footer"> <div class="resize-module-container__button resize-module-container__button_type-confirm"> <span>Сохранить изменения</span> </div> <div class="resize-module-container__button resize-module-container__button_type-deny"> <span>Вернуться назад</span> </div> </div> <canvas class="canvas_crop"></canvas> </div> '),document.body.appendChild(t);var n,o,i,r,c,a,u,d,s=document.querySelectorAll('input[class="imageResizeAndCrop"]'),l=1,h=new DataTransfer,m=document.querySelector(".resize-module-container__body-image"),p=document.querySelector(".resize-module-container__body-image-area"),v=document.querySelector(".resize-module-container__body-paragraph"),_=m.getBoundingClientRect(),b=0,f=0,y=0,g=0;t.addEventListener("selectstart",(function(e){return e.preventDefault()}));var w,z,x=new FileReader,k=function(){var e=document.body.style.top;document.body.style.position="",document.body.style.top="",window.scrollTo(0,-1*parseInt(e||"0")),document.body.style.overflowY=""},E=function(){p.style.height=_.height-b-y+"px",p.style.width=_.width-f-g+"px",document.querySelector(".resize-module-container__background_pos_t").style.height=b+"px",document.querySelector(".resize-module-container__background_pos_b").style.height=y+"px",document.querySelector(".resize-module-container__background_pos_l").style.top=b+"px",document.querySelector(".resize-module-container__background_pos_l").style.bottom=y+"px",document.querySelector(".resize-module-container__background_pos_l").style.width=f+"px",document.querySelector(".resize-module-container__background_pos_r").style.top=b+"px",document.querySelector(".resize-module-container__background_pos_r").style.bottom=y+"px",document.querySelector(".resize-module-container__background_pos_r").style.width=g+"px"},L=function(){p.style.backgroundPosition=-f+"px "+-b+"px",p.style.left=f+"px",p.style.right=g+"px",p.style.top=b+"px",p.style.bottom=y+"px"};!function(){s.forEach((function(t){t.addEventListener("change",(function(){n=t,function(){var t,c,a,u;t=this,c=void 0,u=function(){var t,c,a;return function(e,t){var n,o,i,r,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(c=0)),c;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,o=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){c.label=a[1];break}if(6===a[0]&&c.label<i[1]){c.label=i[1],i=a;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(a);break}i[2]&&c.ops.pop(),c.trys.pop();continue}a=t.call(e,c)}catch(e){a=[6,e],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,(function(u){switch(u.label){case 0:return o=Number(n.getAttribute("data-target-width")),i=Number(n.getAttribute("data-target-height")),t=n.getAttribute("data-module-title"),v.textContent=""!==t||void 0!==t?t:"Модуль обработки изображений",c=n.files[0],[4,e(c,{quality:Math.min(1,2097152/c.size),type:"image/jpeg"})];case 1:return a=u.sent(),x.readAsDataURL(a),x.addEventListener("load",(function(){(r=new Image).src=x.result,r.addEventListener("load",p)}),{once:!0}),[2]}}))},new((a=void 0)||(a=Promise))((function(e,n){function o(e){try{r(u.next(e))}catch(e){n(e)}}function i(e){try{r(u.throw(e))}catch(e){n(e)}}function r(t){var n;t.done?e(t.value):(n=t.value,n instanceof a?n:new a((function(e){e(n)}))).then(o,i)}r((u=u.apply(t,c||[])).next())}))}()}))}));var u,d,p=function(){r.width<o||r.height<i?(S(),alert("Размер изображения не соответствует заданным параметрам.")):r.width===o&&r.height===i||C()},w=function(){c=r.naturalWidth,a=r.naturalHeight;var e=c/Math.min(window.innerWidth,900),t=a/Math.min(window.innerHeight-200,600);l=Math.min(e,t),m.style.width=c/l-88+"px",m.style.height=a/l-88+"px",m.style.backgroundSize=c/l-88+"px "+(a/l-88)+"px",m.style.backgroundImage="url('"+x.result+"')",_=m.getBoundingClientRect(),m.scrollIntoView({block:"center",inline:"center"});var n=Math.min(_.width,_.height*o/i),u=Math.min(_.height,_.width*i/o);f=(_.width-n)/2,g=(_.width-n)/2,b=(_.height-u)/2,y=(_.height-u)/2,E(),L()},z=function(){w()};window.removeEventListener("resize",z),u=document.querySelector(".resize-module-container__button_type-confirm"),d=document.querySelector(".canvas_crop"),u.addEventListener("click",(function(){k();var e=c/_.width,t=a/_.height;d.width=o,d.height=i,d.getContext("2d").drawImage(r,f*e,b*t,c-f*e-g*e,a-b*t-y*t,0,0,d.width,d.height),d.toBlob((function(e){h.items.clear(),h.items.add(new File([e],"updatedFile.png",{type:"image/png"})),n.files=h.files})),q()}));var S=function(){n.files=null,n.value="",q()},q=function(){k(),t.classList.add("resize-module_disable"),window.removeEventListener("resize",z)},C=function(){document.body.style.top="-"+window.scrollY+"px",document.body.style.position="fixed",document.body.clientHeight>document.scrollingElement.clientHeight&&(document.body.style.overflowY="scroll"),t.classList.remove("resize-module_disable"),window.addEventListener("resize",z),w()};document.querySelector(".resize-module-container__button_type-deny").addEventListener("click",S),document.querySelector(".resize-module-container__close-button").addEventListener("click",S)}(),w=0,z=0,function(){var e,t,n,r,c=function(o){n=e,r=t,"touchstart"===o.type||"touchmove"===o.type||"touchend"===o.type?(e=o.touches[0].clientX,t=o.touches[0].clientY):(e=o.clientX,t=o.clientY)},a=function(){b<0&&(y+=b,b=0),f<0&&(g+=f,f=0),y<0&&(b+=y,y=0),g<0&&(f+=g,g=0)},s=function(n){n.preventDefault(),_=m.getBoundingClientRect(),c(n),1===w?(u=f+_.left,d=_.height+_.top-y):2===w?(u=_.width+_.left-g,d=_.height+_.top-y):3===w?(u=_.width+_.left-g,d=b+_.top):4===w?(u=f+_.left,d=b+_.top):(u=e,d=t,b<=t-_.top&&y<=_.top+_.height-t&&f<=e-_.left&&g<=_.left+_.width-e&&(w=-1)),document.addEventListener("touchmove",h),document.addEventListener("mousemove",h)};m.addEventListener("mousedown",s),m.addEventListener("touchstart",s),document.querySelector(".scale-cube_pos_tr").addEventListener("mousedown",(function(){w=1})),document.querySelector(".scale-cube_pos_tl").addEventListener("mousedown",(function(){w=2})),document.querySelector(".scale-cube_pos_bl").addEventListener("mousedown",(function(){w=3})),document.querySelector(".scale-cube_pos_br").addEventListener("mousedown",(function(){w=4})),document.querySelector(".scale-cube_pos_tr").addEventListener("touchstart",(function(){w=1})),document.querySelector(".scale-cube_pos_tl").addEventListener("touchstart",(function(){w=2})),document.querySelector(".scale-cube_pos_bl").addEventListener("touchstart",(function(){w=3})),document.querySelector(".scale-cube_pos_br").addEventListener("touchstart",(function(){w=4}));var h=function(n){c(n);var r=0,s=0;z=0,-1!==w&&(1===w?(f=u,y=_.height-d):2===w?(g=_.width-u,y=_.height-d):3===w?(g=_.width-u,b=d):4===w&&(f=u,b=d),e>=u?(r=1,f=u-_.left,g=_.width+_.left-e):(r=-1,f=e-_.left,g=_.width+_.left-u),t>=d?(s=1,b=d-_.top,y=_.height+_.top-t):(s=-1,b=t-_.top,y=_.height+_.top-d),1===r&&-1===s?z=1:-1===r&&-1===s?z=2:-1===r&&1===s?z=3:1===r&&1===s&&(z=4)),1!==z&&2!==z||(b=t-_.top)<0&&(b=0),3!==z&&4!==z||(y=_.top+_.height-t)<0&&(y=0),2!==z&&3!==z||(f=e-_.left)<0&&(f=0),4!==z&&1!==z||(g=_.left+_.width-e)<0&&(g=0),0!==o&&0!==i&&p(),a(),E(),L()},p=function(){var c=(_.width-f-g)*i,a=(_.height-b-y)*o;1===z?c<=a?b+=(a-c)/o:g+=(c-a)/i:2===z?c<=a?b+=(a-c)/o:f+=(c-a)/i:3===z?c<=a?y+=(a-c)/o:f+=(c-a)/i:4===z?c<=a?y+=(a-c)/o:g+=(c-a)/i:-1===w&&(f+=e-n,g-=e-n,b+=t-r,y-=t-r,n=e,r=t)},v=function(){var e,t;p(),e=_.height-b-y,t=_.width-f-g,(e<i/l||t<o/l)&&(1===z?(b=_.height-y-i/l,g=_.width-f-o/l):2===z?(b=_.height-y-i/l,f=_.width-g-o/l):3===z?(y=_.height-b-i/l,f=_.width-g-o/l):4===z&&(y=_.height-b-i/l,g=_.width-f-o/l)),p(),a(),E(),L(),w=0,document.removeEventListener("mousemove",h),document.removeEventListener("touchmove",h)};document.addEventListener("mouseup",v),document.addEventListener("touchend",v)}()})();